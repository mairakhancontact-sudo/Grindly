<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grindly | Quest System - EPIC EDITION</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <style>
        /* ===== QUEST SYSTEM STYLES - FIXED TEXT DISPLAY ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0a0f1f;
            --card: #151e2f;
            --card-hover: #1e2a3a;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #2a3548;
            --accent: #4f46e5;
            --rpg-gold: #fbbf24;
            --rpg-silver: #94a3b8;
            --rpg-health: #ef4444;
            --rpg-mana: #3b82f6;
            --rpg-xp: #f59e0b;
            --rpg-legendary: #f97316;
            --rpg-epic: #a855f7;
            --rpg-rare: #3b82f6;
            --rpg-uncommon: #22c55e;
            --rpg-common: #64748b;
            
            /* New Colors */
            --streak-fire: #ff6b6b;
            --achievement-gold: #ffd700;
            --premium-purple: #9b59b6;
            --special-cyan: #00d2d3;
            --boss-red: #e74c3c;
            
            /* Responsive spacing */
            --space-xs: clamp(0.25rem, 1vw, 0.5rem);
            --space-sm: clamp(0.5rem, 2vw, 0.75rem);
            --space-md: clamp(0.75rem, 3vw, 1rem);
            --space-lg: clamp(1rem, 4vw, 1.5rem);
            --space-xl: clamp(1.5rem, 5vw, 2rem);
            --space-2xl: clamp(2rem, 6vw, 3rem);
        }

        /* Responsive base */
        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: var(--space-md);
            position: relative;
            overflow-x: hidden;
        }

        .container {
            max-width: min(1200px, 100% - 2rem);
            margin: 0 auto;
        }

        /* ===== FEATURE 1: STREAK FLAME ===== */
        .streak-flame-container {
            position: relative;
            display: inline-block;
            margin-right: var(--space-sm);
        }

        .streak-flame {
            font-size: clamp(1.5rem, 5vw, 2rem);
            filter: drop-shadow(0 0 10px var(--streak-fire));
            animation: flameFlicker 1.5s ease-in-out infinite;
            display: inline-block;
        }

        @keyframes flameFlicker {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px #ff6b6b); }
            25% { transform: scale(1.1); filter: drop-shadow(0 0 15px #ff8c8c); }
            50% { transform: scale(1.2); filter: drop-shadow(0 0 25px #ffa07a); }
            75% { transform: scale(1.1); filter: drop-shadow(0 0 15px #ff8c8c); }
        }

        .streak-counter {
            font-size: clamp(1rem, 4vw, 1.5rem);
            font-weight: 900;
            background: linear-gradient(135deg, #ff6b6b, #ff8c8c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ===== FEATURE 2: ACHIEVEMENT POPUPS ===== */
        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--card), #0f172a);
            border: 3px solid var(--achievement-gold);
            border-radius: 20px;
            padding: var(--space-lg);
            max-width: min(350px, 90vw);
            z-index: 9999;
            animation: achievementSlide 0.5s ease-out, achievementGlow 2s infinite;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
            pointer-events: none;
        }

        @keyframes achievementSlide {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes achievementGlow {
            0%, 100% { box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 10px 60px rgba(255, 215, 0, 0.6); }
        }

        .achievement-icon {
            font-size: clamp(2rem, 8vw, 3rem);
            margin-right: var(--space-md);
            filter: drop-shadow(0 0 10px gold);
        }

        .achievement-title {
            font-size: clamp(1rem, 4vw, 1.2rem);
            font-weight: 900;
            color: var(--achievement-gold);
            text-transform: uppercase;
        }

        .achievement-name {
            font-size: clamp(1.2rem, 5vw, 1.5rem);
            font-weight: 700;
            color: white;
        }

        /* ===== FEATURE 3: BOSS BATTLE PROGRESS ===== */
        .boss-section {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.2));
            border: 3px solid var(--boss-red);
            border-radius: 30px;
            padding: var(--space-xl);
            margin: var(--space-2xl) 0;
            position: relative;
            overflow: hidden;
            animation: bossPulse 3s infinite;
        }

        @keyframes bossPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(231, 76, 60, 0.3); }
            50% { box-shadow: 0 0 60px rgba(231, 76, 60, 0.6); }
        }

        .boss-header {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            flex-wrap: wrap;
        }

        .boss-icon {
            font-size: clamp(3rem, 12vw, 5rem);
            animation: bossFloat 3s ease-in-out infinite;
        }

        @keyframes bossFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .boss-title {
            font-size: clamp(1.5rem, 6vw, 2rem);
            font-weight: 900;
            color: var(--boss-red);
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        .boss-health-bar {
            width: 100%;
            height: clamp(20px, 5vh, 30px);
            background: #2c3e50;
            border-radius: 20px;
            overflow: hidden;
            border: 3px solid var(--boss-red);
            margin: var(--space-lg) 0;
        }

        .boss-health-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #e74c3c, #c0392b, #e74c3c);
            background-size: 200% 100%;
            animation: bossHealthPulse 2s infinite;
            transition: width 0.5s ease;
        }

        @keyframes bossHealthPulse {
            0% { background-position: 0% 0; }
            50% { background-position: 100% 0; }
            100% { background-position: 0% 0; }
        }

        .boss-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(150px, 100%), 1fr));
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .boss-stat {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: var(--space-md);
            text-align: center;
            border: 2px solid var(--boss-red);
        }

        /* ===== FEATURE 4: PET COMPANION ===== */
        .pet-section {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.2));
            border: 3px solid var(--premium-purple);
            border-radius: 30px;
            padding: var(--space-xl);
            margin: var(--space-2xl) 0;
            position: relative;
        }

        .pet-container {
            display: flex;
            align-items: center;
            gap: var(--space-xl);
            flex-wrap: wrap;
        }

        .pet-avatar {
            font-size: clamp(3rem, 12vw, 5rem);
            filter: drop-shadow(0 0 20px var(--premium-purple));
            animation: petBounce 2s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .pet-avatar:hover {
            transform: scale(1.1);
        }

        @keyframes petBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .pet-info {
            flex: 1;
            min-width: min(250px, 100%);
        }

        .pet-name {
            font-size: clamp(1.3rem, 5vw, 1.8rem);
            font-weight: 900;
            color: var(--premium-purple);
            margin-bottom: var(--space-sm);
        }

        .pet-level-bar {
            height: clamp(10px, 3vh, 15px);
            background: #2c3e50;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--premium-purple);
        }

        .pet-level-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #9b59b6, #8e44ad, #9b59b6);
            background-size: 200% 100%;
            animation: petLevelPulse 2s infinite;
            transition: width 0.5s ease;
        }

        .pet-messages {
            margin-top: var(--space-md);
            padding: var(--space-md);
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            border-left: 4px solid var(--premium-purple);
            font-style: italic;
            animation: petMessageGlow 2s infinite;
        }

        @keyframes petMessageGlow {
            0%, 100% { border-left-color: var(--premium-purple); }
            50% { border-left-color: #d980fa; }
        }

        /* ===== FEATURE 5: SPECIAL EVENTS ===== */
        .events-section {
            background: linear-gradient(135deg, rgba(0, 210, 211, 0.1), rgba(0, 184, 212, 0.2));
            border: 3px solid var(--special-cyan);
            border-radius: 30px;
            padding: var(--space-xl);
            margin: var(--space-2xl) 0;
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }

        .event-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.5), rgba(0,0,0,0.7));
            border: 2px solid var(--special-cyan);
            border-radius: 20px;
            padding: var(--space-lg);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 210, 211, 0.3);
        }

        .event-card.active {
            animation: eventPulse 1.5s infinite;
        }

        @keyframes eventPulse {
            0%, 100% { border-color: var(--special-cyan); }
            50% { border-color: #00ffff; }
        }

        .event-timer {
            position: absolute;
            top: var(--space-sm);
            right: var(--space-sm);
            background: rgba(0,0,0,0.8);
            padding: var(--space-xs) var(--space-sm);
            border-radius: 20px;
            border: 2px solid var(--special-cyan);
            font-size: clamp(0.7rem, 3vw, 0.9rem);
            font-weight: 700;
            color: var(--special-cyan);
        }

        .event-icon {
            font-size: clamp(2rem, 8vw, 3rem);
            margin-bottom: var(--space-sm);
        }

        .event-name {
            font-size: clamp(1.1rem, 5vw, 1.3rem);
            font-weight: 900;
            color: var(--special-cyan);
            margin-bottom: var(--space-xs);
            word-wrap: break-word;
        }

        .event-desc {
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            color: var(--text-muted);
            margin-bottom: var(--space-md);
            word-wrap: break-word;
        }

        .event-reward {
            background: linear-gradient(135deg, var(--special-cyan), #00b894);
            color: black;
            padding: var(--space-xs) var(--space-sm);
            border-radius: 20px;
            font-weight: 700;
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            display: inline-block;
        }

        /* Header (Responsive) */
        .quest-header {
            background: linear-gradient(135deg, var(--card), #0f172a);
            border: 3px solid var(--rpg-gold);
            border-radius: 30px;
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .quest-title {
            font-size: clamp(1.5rem, 6vw, 2rem);
            font-weight: 800;
            color: var(--rpg-gold);
            text-shadow: 2px 2px 0 #000;
        }

        .back-btn {
            background: var(--rpg-gold);
            color: black;
            border: none;
            padding: var(--space-sm) var(--space-lg);
            border-radius: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(0.8rem, 3vw, 1rem);
            white-space: nowrap;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(251,191,36,0.3);
        }

        /* Game Master Panel (Responsive) */
        .game-master-panel {
            position: fixed;
            bottom: clamp(10px, 5vw, 30px);
            right: clamp(10px, 5vw, 30px);
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: var(--space-sm);
            z-index: 1000;
            pointer-events: none;
            max-width: min(350px, 90vw);
        }

        .gm-bubble {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 3px solid var(--rpg-gold);
            border-radius: 20px 20px 5px 20px;
            padding: var(--space-md) var(--space-lg);
            color: var(--text);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: bubbleAppear 0.3s ease-out;
            position: relative;
            font-family: 'Courier New', monospace;
            backdrop-filter: blur(10px);
            pointer-events: auto;
            width: 100%;
            font-size: clamp(0.8rem, 3vw, 0.95rem);
            line-height: 1.5;
        }

        .gm-bubble::after {
            content: '';
            position: absolute;
            bottom: -12px;
            right: 20px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-right: 3px solid var(--rpg-gold);
            border-bottom: 3px solid var(--rpg-gold);
            transform: rotate(45deg);
            border-radius: 0 0 5px 0;
        }

        .gm-character {
            width: clamp(60px, 15vw, 80px);
            height: clamp(60px, 15vw, 80px);
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 30px 30px 30px 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(2rem, 8vw, 3rem);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(251,191,36,0.3);
            border: 3px solid var(--rpg-gold);
            pointer-events: auto;
            animation: gmFloat 3s ease-in-out infinite;
            margin-left: auto;
        }

        /* Hero Section (Responsive) */
        .hero-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
            gap: var(--space-lg);
            background: rgba(0,0,0,0.4);
            border-radius: 30px;
            padding: var(--space-lg);
            border: 2px solid var(--rpg-gold);
            margin-bottom: var(--space-xl);
        }

        .player-card {
            text-align: center;
            background: linear-gradient(135deg, rgba(251,191,36,0.1), rgba(0,0,0,0.5));
            border-radius: 20px;
            padding: var(--space-lg);
            border: 2px solid var(--rpg-gold);
        }

        .player-avatar {
            font-size: clamp(3rem, 12vw, 5rem);
            background: linear-gradient(135deg, var(--rpg-gold), var(--rpg-legendary));
            width: clamp(80px, 20vw, 120px);
            height: clamp(80px, 20vw, 120px);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-md);
            transform: rotate(5deg);
            box-shadow: 0 0 30px rgba(251,191,36,0.3);
        }

        .player-name {
            font-size: clamp(1.2rem, 5vw, 1.5rem);
            font-weight: 800;
            color: var(--rpg-gold);
            margin-bottom: var(--space-xs);
        }

        .player-title {
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            color: var(--rpg-silver);
            background: rgba(0,0,0,0.5);
            padding: var(--space-xs);
            border-radius: 30px;
        }

        /* Resource Bars (Responsive) */
        .resource-bars {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .resource-header {
            display: flex;
            justify-content: space-between;
            color: var(--text);
            margin-bottom: var(--space-xs);
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            text-transform: uppercase;
        }

        .resource-track {
            height: clamp(15px, 4vh, 20px);
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        /* Stats Grid (Responsive) */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(0,0,0,0.8));
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            transition: all 0.3s ease;
        }

        .stat-icon { 
            font-size: clamp(1.5rem, 6vw, 2.5rem); 
            min-width: clamp(40px, 10vw, 60px); 
            text-align: center; 
        }
        .stat-value { 
            font-size: clamp(1.2rem, 5vw, 2rem); 
            font-weight: 800; 
            color: var(--text); 
            line-height: 1; 
        }
        .stat-label { 
            font-size: clamp(0.7rem, 2.5vw, 0.8rem); 
            color: var(--rpg-silver); 
            text-transform: uppercase; 
        }
        .stat-bonus { 
            font-size: clamp(0.6rem, 2vw, 0.7rem); 
            color: var(--rpg-gold); 
        }

        /* Quick Actions (Responsive) */
        .quick-actions {
            display: flex;
            gap: var(--space-sm);
            margin: var(--space-xl) 0;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: var(--space-sm) var(--space-lg);
            border: none;
            border-radius: 15px;
            font-weight: 700;
            font-size: clamp(0.8rem, 3vw, 1rem);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            background: linear-gradient(135deg, var(--rpg-gold), #f59e0b);
            color: black;
            flex: 1 1 auto;
            min-width: min(120px, 100%);
            justify-content: center;
        }

        /* Quest Categories */
        .quest-category {
            margin-bottom: var(--space-2xl);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-sm);
            border-bottom: 3px solid var(--rpg-gold);
            flex-wrap: wrap;
        }

        .category-icon { 
            font-size: clamp(1.5rem, 6vw, 2rem); 
            animation: spin 4s linear infinite; 
        }
        .category-title {
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            font-weight: 800;
            color: var(--rpg-gold);
        }
        .category-badge {
            margin-left: auto;
            background: var(--rpg-gold);
            color: black;
            padding: var(--space-xs) var(--space-md);
            border-radius: 30px;
            font-weight: 700;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            white-space: nowrap;
        }

        /* Quest Cards - FIXED TEXT DISPLAY */
        .quest-card {
            background: linear-gradient(135deg, rgba(30,40,60,0.9), rgba(20,30,50,0.95));
            border: 2px solid;
            border-radius: 20px;
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            transition: all 0.3s ease;
            position: relative;
            animation: questAppear 0.5s ease-out;
            width: 100%;
            overflow: visible;
        }

        .quest-header {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            margin-bottom: var(--space-sm);
            flex-wrap: nowrap;
        }

        .quest-icon {
            width: clamp(40px, 8vw, 60px);
            height: clamp(40px, 8vw, 60px);
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.5rem, 5vw, 2.2rem);
            flex-shrink: 0;
        }

        .quest-info {
            flex: 1;
            min-width: 0; /* Allows flex item to shrink below content size */
        }

        .quest-name {
            font-size: clamp(1.1rem, 4vw, 1.3rem);
            font-weight: 700;
            color: var(--text);
            margin-bottom: var(--space-xs);
            line-height: 1.3;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        .quest-meta {
            display: flex;
            gap: var(--space-sm);
            align-items: center;
            flex-wrap: wrap;
        }

        .quest-rarity {
            padding: var(--space-xs) var(--space-sm);
            border-radius: 30px;
            font-size: clamp(0.6rem, 2vw, 0.7rem);
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .quest-xp { 
            color: var(--rpg-xp); 
            font-weight: 600; 
            display: flex; 
            align-items: center; 
            gap: var(--space-xs); 
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            white-space: nowrap;
        }

        .quest-description { 
            color: var(--rpg-silver); 
            margin-bottom: var(--space-sm); 
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .quest-rewards {
            display: flex;
            gap: var(--space-sm);
            margin: var(--space-sm) 0;
            flex-wrap: wrap;
        }

        .reward-chip {
            background: rgba(0,0,0,0.5);
            border: 2px solid var(--rpg-gold);
            border-radius: 30px;
            padding: var(--space-xs) var(--space-sm);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            color: var(--rpg-gold);
            white-space: nowrap;
        }

        .quest-progress {
            margin: var(--space-sm) 0;
        }

        .progress-track {
            height: 8px;
            background: rgba(0,0,0,0.5);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--space-xs);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--rpg-gold), var(--rpg-legendary));
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            color: var(--text-muted);
        }

        .quest-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        .quest-btn {
            flex: 1;
            padding: var(--space-sm);
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: clamp(0.8rem, 3vw, 1rem);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 0;
            word-wrap: break-word;
        }

        /* New Quest Indicator */
        .new-quest-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: black;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 900;
            border: 2px solid #000;
            animation: badgePulse 1s infinite;
            z-index: 10;
            white-space: nowrap;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Toast Notification (Responsive) */
        .toast {
            position: fixed;
            top: clamp(10px, 5vw, 20px);
            right: clamp(10px, 5vw, 20px);
            background: linear-gradient(135deg, var(--card), #0f172a);
            border: 2px solid var(--rpg-gold);
            border-radius: 15px;
            padding: var(--space-sm) var(--space-md);
            color: white;
            z-index: 9999;
            animation: slideIn 0.3s ease;
            max-width: min(350px, 90vw);
            font-size: clamp(0.8rem, 3vw, 0.95rem);
            word-wrap: break-word;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px;
            color: var(--text-muted);
            background: rgba(0,0,0,0.3);
            border-radius: 30px;
        }

        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--rpg-gold);
            font-size: 1.2rem;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .hero-section {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quest-description,
            .quest-rewards,
            .quest-progress,
            .quest-actions {
                padding-left: 0;
            }
            
            .game-master-panel {
                bottom: 10px;
                right: 10px;
                max-width: 280px;
            }
            
            .category-badge {
                margin-left: 0;
                width: 100%;
                text-align: center;
            }
            
            .boss-header {
                justify-content: center;
                text-align: center;
            }
            
            .pet-container {
                justify-content: center;
                text-align: center;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
            }
            
            .quest-header {
                flex-wrap: wrap;
            }
            
            .quest-meta {
                width: 100%;
            }
        }

        /* Small mobile optimization */
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .quest-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .quest-meta {
                width: 100%;
                justify-content: flex-start;
            }
            
            .event-timer {
                position: static;
                margin-bottom: var(--space-sm);
                display: inline-block;
            }
            
            .quest-name {
                font-size: 1.1rem;
            }
        }

        /* Desktop optimization */
        @media (min-width: 1024px) {
            .quest-card {
                padding: 1.5rem;
            }
            
            .quest-name {
                font-size: 1.3rem;
            }
            
            .quest-description {
                font-size: 0.95rem;
            }
            
            .reward-chip {
                font-size: 0.9rem;
            }
            
            .quest-rarity {
                font-size: 0.7rem;
            }
        }

        /* Landscape mode optimization */
        @media (orientation: landscape) and (max-height: 600px) {
            .game-master-panel {
                bottom: 5px;
                right: 5px;
            }
            
            .gm-character {
                width: 50px;
                height: 50px;
                font-size: 2rem;
            }
            
            .hero-section {
                padding: var(--space-sm);
            }
        }

        /* Touch target optimization */
        button, .quest-btn, .action-btn, .back-btn, .gm-character, .pet-avatar, .event-card {
            min-height: 44px;
            min-width: 44px;
        }

        /* Prevent zoom on input */
        select, input, textarea, button {
            font-size: 16px;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Better touch scrolling */
        .container {
            -webkit-overflow-scrolling: touch;
        }

        /* Ensure text is always visible */
        .quest-name, .quest-description, .event-name, .event-desc, .pet-name, .boss-title {
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quest-header">
            <div class="quest-title">üéÆ RPG QUEST SYSTEM</div>
            <button class="back-btn" onclick="goBack()">‚Üê Back to Dashboard</button>
        </div>
        
        <div id="questContent">
            <div class="loading">Loading quest data...</div>
        </div>
    </div>

    <!-- Game Master Panel -->
    <div class="game-master-panel" id="gameMasterPanel">
        <div class="gm-bubble" id="gmBubble">
            üßô‚Äç‚ôÇÔ∏è Greetings, Adventurer! I track your REAL study data. Click me for tips!
        </div>
        <div class="gm-character" id="gmCharacter" onclick="gmClick()">
            üßô‚Äç‚ôÇÔ∏è
        </div>
    </div>

    <div id="toastContainer" class="toast-container"></div>
    <div id="achievementContainer"></div>

    <script>
        // ===== QUEST SYSTEM WITH 5 NEW COOL FEATURES =====
        (function() {
            console.log("üéÆ Quest System loaded with 5 New Features");

            // Game Master Messages
            const GM_MESSAGES = {
                welcome: "üßô‚Äç‚ôÇÔ∏è I track your REAL study data! Every task, hour, and streak is recorded!",
                xp: "‚ú® You have {{xp}} XP. Need {{xpNeeded}} more for level {{nextLevel}}!",
                health: "‚ù§Ô∏è Health based on your consistency. Currently {{health}}/{{maxHealth}}!",
                mana: "üíô Mana = {{mana}}/{{maxMana}}. Earned from focus sessions!",
                stats: "üìä STR:{{str}} ({{tasks}} tasks), INT:{{int}} ({{hours}} hrs), WIS:{{wis}} ({{streak}} streak), LUK:{{luk}}",
                daily: "üìÖ {{dailyDone}}/{{dailyTotal}} daily quests done. {{dailyLeft}} left today!",
                weekly: "üìÜ {{weeklyDone}}/{{weeklyTotal}} weekly quests. {{weeklyLeft}} remain this week!",
                legendary: "üåü Completed {{legendaryDone}} legendary quests. {{legendaryLeft}} to go!",
                streak: "üî• Current streak: {{streak}} days. Keep it going!",
                level: "üåü Level {{level}}. {{xp}}/{{xpToNext}} XP to next level!",
                mana_tip: "üíô Mana regenerates over time. Use it for dice rolls!",
                health_tip: "‚ù§Ô∏è Health = {{health}}%. Stay consistent to keep it high!",
                new_quest: "‚ú® A new quest has appeared! Complete it for rewards!",
                quest_replaced: "üîÑ Old quest completed! A fresh challenge awaits!",
                pet: "üêæ Your pet is happy! Keep studying to make it grow!",
                boss: "üëæ The BOSS is watching! Complete quests to defeat it!",
                event: "üéâ Special event active! Double rewards!"
            };

            // Constants
            const RPG_STORAGE_KEY = 'studentRpgData';
            const ACHIEVEMENTS_KEY = 'studentEarnedBadges';
            const NOTIFIED_KEY = 'studentNotifiedAchievements';
            const PET_KEY = 'studentPetData';
            const BOSS_KEY = 'studentBossData';
            const EVENTS_KEY = 'studentEventsData';

            // Game Titles
            const GAME_TITLES = [
                { level: 1, title: 'Novice Adventurer', icon: 'üå±' },
                { level: 3, title: 'Apprentice Scholar', icon: 'üìö' },
                { level: 5, title: 'Skilled Warrior', icon: '‚öîÔ∏è' },
                { level: 7, title: 'Wise Sage', icon: 'üîÆ' },
                { level: 9, title: 'Lucky Rogue', icon: 'üçÄ' },
                { level: 11, title: 'Elite Guardian', icon: 'üõ°Ô∏è' },
                { level: 13, title: 'Mystic Mage', icon: 'üîÆ' },
                { level: 15, title: 'Legendary Hero', icon: 'üåü' },
                { level: 20, title: 'Dragon Slayer', icon: 'üêâ' },
                { level: 25, title: 'Arcane Master', icon: '‚ú®' },
                { level: 30, title: 'Immortal Champion', icon: 'üèÜ' }
            ];

            // Quest Templates
            const QUEST_TEMPLATES = {
                daily: [
                    { id: 'daily_focus', name: 'üßò Focus Warrior', description: 'Complete a focused study session', icon: 'üéØ', xp: 50, requirement: 1, rarity: 'common', stats: { wisdom: 1 } },
                    { id: 'daily_tasks', name: '‚öîÔ∏è Task Slayer', description: 'Complete 3 tasks', icon: '‚úì', xp: 60, requirement: 3, rarity: 'uncommon', stats: { strength: 1 } },
                    { id: 'daily_streak', name: 'üî• Streak Keeper', description: 'Maintain your study streak', icon: 'üî•', xp: 75, requirement: 1, rarity: 'rare', stats: { luck: 1 } },
                    { id: 'daily_hours', name: '‚åõ Time Mage', description: 'Study for 2 hours', icon: '‚åõ', xp: 100, requirement: 2, rarity: 'epic', stats: { intelligence: 1 } },
                    { id: 'daily_early', name: 'üåÖ Early Bird', description: 'Study before 8 AM', icon: 'üåÖ', xp: 80, requirement: 1, rarity: 'rare', stats: { wisdom: 1, luck: 1 } },
                    { id: 'daily_night', name: 'ü¶â Night Owl', description: 'Study after 10 PM', icon: 'üåô', xp: 80, requirement: 1, rarity: 'rare', stats: { intelligence: 1, luck: 1 } },
                    { id: 'daily_perfect', name: 'üíØ Perfect Day', description: 'Complete all daily quests', icon: 'üíØ', xp: 150, requirement: 1, rarity: 'epic', stats: { all: 2 } }
                ],
                weekly: [
                    { id: 'weekly_streak', name: 'üèÜ Streak Legend', description: 'Maintain a 7-day streak', icon: 'üî•', xp: 500, requirement: 7, rarity: 'epic', stats: { luck: 3, wisdom: 2 } },
                    { id: 'weekly_tasks', name: '‚öîÔ∏è Quest Master', description: 'Complete 20 tasks', icon: 'üìú', xp: 400, requirement: 20, rarity: 'epic', stats: { strength: 3, intelligence: 2 } },
                    { id: 'weekly_hours', name: '‚è∞ Time Lord', description: 'Study 12 hours', icon: '‚åõ', xp: 600, requirement: 12, rarity: 'legendary', stats: { intelligence: 3, wisdom: 2 } },
                    { id: 'weekly_focus', name: 'üéØ Focus Champion', description: 'Complete 10 focus sessions', icon: 'üéØ', xp: 450, requirement: 10, rarity: 'epic', stats: { wisdom: 3, luck: 2 } },
                    { id: 'weekly_perfect', name: 'üåü Perfect Week', description: 'Study every day for a week', icon: 'üåü', xp: 800, requirement: 7, rarity: 'legendary', stats: { all: 4 } }
                ],
                legendary: [
                    { id: 'legend_first', name: 'üåü First Steps', description: 'Complete your first quest', icon: 'üå±', xp: 100, requirement: 1, rarity: 'common', stats: { luck: 2 } },
                    { id: 'legend_10', name: '‚öîÔ∏è Quest Apprentice', description: 'Complete 10 quests', icon: '‚öîÔ∏è', xp: 250, requirement: 10, rarity: 'uncommon', stats: { strength: 2, intelligence: 2 } },
                    { id: 'legend_50', name: 'üëë Quest Warrior', description: 'Complete 50 quests', icon: 'üëë', xp: 600, requirement: 50, rarity: 'rare', stats: { wisdom: 3, luck: 3 } },
                    { id: 'legend_100', name: '‚ú® Quest Legend', description: 'Complete 100 quests', icon: '‚ú®', xp: 1200, requirement: 100, rarity: 'epic', stats: { all: 4 } },
                    { id: 'legend_streak_30', name: 'üåã Inferno Master', description: 'Achieve a 30-day streak', icon: 'üî•', xp: 2000, requirement: 30, rarity: 'legendary', stats: { all: 5 } },
                    { id: 'legend_tasks_500', name: 'üí™ Task Overlord', description: 'Complete 500 tasks', icon: 'üí™', xp: 1500, requirement: 500, rarity: 'legendary', stats: { all: 4 } },
                    { id: 'legend_hours_100', name: '‚åõ Time Wizard', description: 'Study 100 hours', icon: '‚è≥', xp: 1800, requirement: 100, rarity: 'legendary', stats: { all: 5 } }
                ]
            };

            // ===== FEATURE 1: STREAK FLAME =====
            function getStreakFlame(streak) {
                if (streak >= 30) return 'üî•üî•üî• INFERNO';
                if (streak >= 14) return 'üî•üî• BLAZE';
                if (streak >= 7) return 'üî• FLAME';
                if (streak >= 3) return 'üî• SPARK';
                return 'üî• EMBER';
            }

            // ===== FEATURE 2: ACHIEVEMENT POPUPS =====
            let achievementQueue = [];
            let showingAchievement = false;

            function showAchievement(title, name, icon) {
                achievementQueue.push({ title, name, icon });
                if (!showingAchievement) {
                    processAchievementQueue();
                }
            }

            function processAchievementQueue() {
                if (achievementQueue.length === 0) {
                    showingAchievement = false;
                    return;
                }

                showingAchievement = true;
                const ach = achievementQueue.shift();
                
                const popup = document.createElement('div');
                popup.className = 'achievement-popup';
                popup.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <div class="achievement-icon">${ach.icon}</div>
                        <div>
                            <div class="achievement-title">${ach.title}</div>
                            <div class="achievement-name">${ach.name}</div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(popup);
                
                setTimeout(() => {
                    popup.remove();
                    setTimeout(processAchievementQueue, 500);
                }, 3000);
            }

            // ===== FEATURE 3: PET COMPANION =====
            function loadPetData() {
                try {
                    const saved = localStorage.getItem(PET_KEY);
                    if (saved) {
                        return JSON.parse(saved);
                    }
                } catch (e) {}
                
                return {
                    level: 1,
                    xp: 0,
                    xpToNextLevel: 100,
                    name: 'Buddy',
                    type: 'üê∂',
                    messages: [
                        "Let's study together!",
                        "You're doing great!",
                        "Keep going!",
                        "I believe in you!",
                        "One more task!",
                        "You've got this!",
                        "I'm so proud of you!",
                        "Learning is fun!"
                    ],
                    lastMessage: 0
                };
            }

            function savePetData(data) {
                localStorage.setItem(PET_KEY, JSON.stringify(data));
            }

            function updatePet(questsCompleted) {
                const pet = loadPetData();
                const oldLevel = pet.level;
                
                // Pet gains XP from quests
                pet.xp += questsCompleted * 10;
                
                while (pet.xp >= pet.xpToNextLevel) {
                    pet.xp -= pet.xpToNextLevel;
                    pet.level++;
                    pet.xpToNextLevel = Math.floor(pet.xpToNextLevel * 1.5);
                    
                    // Change pet type based on level
                    if (pet.level >= 20) pet.type = 'üêâ';
                    else if (pet.level >= 15) pet.type = 'ü¶Ñ';
                    else if (pet.level >= 10) pet.type = 'ü¶ä';
                    else if (pet.level >= 5) pet.type = 'üê±';
                    else pet.type = 'üê∂';
                    
                    showAchievement('PET LEVEL UP!', `${pet.name} reached level ${pet.level}!`, pet.type);
                }
                
                savePetData(pet);
                return pet;
            }

            function getPetMessage(pet) {
                const now = Date.now();
                if (now - pet.lastMessage > 30000) { // New message every 30 seconds
                    pet.lastMessage = now;
                    const randomIndex = Math.floor(Math.random() * pet.messages.length);
                    return pet.messages[randomIndex];
                }
                return null;
            }

            // ===== FEATURE 4: BOSS BATTLE =====
            function loadBossData() {
                try {
                    const saved = localStorage.getItem(BOSS_KEY);
                    if (saved) {
                        return JSON.parse(saved);
                    }
                } catch (e) {}
                
                return {
                    health: 1000,
                    maxHealth: 1000,
                    level: 1,
                    defeated: false,
                    rewards: [500, 1000, 2000, 5000],
                    currentReward: 0
                };
            }

            function saveBossData(data) {
                localStorage.setItem(BOSS_KEY, JSON.stringify(data));
            }

            function updateBoss(questsCompleted) {
                const boss = loadBossData();
                if (boss.defeated) return boss;
                
                // Boss takes damage from quests
                const damage = questsCompleted * 50;
                boss.health = Math.max(0, boss.health - damage);
                
                if (boss.health <= 0) {
                    boss.defeated = true;
                    const reward = boss.rewards[boss.currentReward];
                    addXP(reward);
                    showAchievement('BOSS DEFEATED!', `You earned ${reward} XP!`, 'üëë');
                    
                    // Spawn next boss level
                    if (boss.currentReward < boss.rewards.length - 1) {
                        boss.currentReward++;
                        boss.level++;
                        boss.health = boss.maxHealth + (boss.level * 500);
                        boss.maxHealth = boss.health;
                        boss.defeated = false;
                        showNotification(`üëæ BOSS LEVEL ${boss.level} HAS APPEARED!`, 'warning');
                    }
                }
                
                saveBossData(boss);
                return boss;
            }

            // ===== FEATURE 5: SPECIAL EVENTS =====
            function loadEvents() {
                try {
                    const saved = localStorage.getItem(EVENTS_KEY);
                    if (saved) {
                        return JSON.parse(saved);
                    }
                } catch (e) {}
                
                const now = Date.now();
                return {
                    active: [],
                    upcoming: [
                        {
                            id: 'event_double_xp',
                            name: 'Double XP Weekend',
                            description: 'Earn twice the XP from all quests!',
                            icon: '‚ú®',
                            reward: '2x XP',
                            startTime: now + 86400000, // Tomorrow
                            duration: 172800000, // 48 hours
                            active: false
                        },
                        {
                            id: 'event_boss_rush',
                            name: 'Boss Rush',
                            description: 'Bosses take double damage!',
                            icon: 'üëæ',
                            reward: '2x Boss Damage',
                            startTime: now + 43200000, // 12 hours
                            duration: 86400000, // 24 hours
                            active: false
                        },
                        {
                            id: 'event_pet_boost',
                            name: 'Pet Growth Spurt',
                            description: 'Your pet gains triple XP!',
                            icon: 'üêæ',
                            reward: '3x Pet XP',
                            startTime: now + 129600000, // 36 hours
                            duration: 86400000, // 24 hours
                            active: false
                        }
                    ],
                    history: []
                };
            }

            function saveEvents(events) {
                localStorage.setItem(EVENTS_KEY, JSON.stringify(events));
            }

            function checkEvents() {
                const events = loadEvents();
                const now = Date.now();
                let eventChanged = false;
                
                // Check upcoming events that should start
                events.upcoming = events.upcoming.filter(event => {
                    if (event.startTime <= now) {
                        event.active = true;
                        event.startTime = now;
                        event.endTime = now + event.duration;
                        events.active.push(event);
                        showNotification(`üéâ EVENT STARTED: ${event.name}!`, 'success');
                        eventChanged = true;
                        return false;
                    }
                    return true;
                });
                
                // Check active events that should end
                events.active = events.active.filter(event => {
                    if (event.endTime <= now) {
                        events.history.push({ ...event, completedAt: now });
                        showNotification(`‚è∞ Event ended: ${event.name}`, 'info');
                        eventChanged = true;
                        return false;
                    }
                    return true;
                });
                
                if (eventChanged) {
                    saveEvents(events);
                }
                
                return events;
            }

            function getEventMultiplier(type) {
                const events = checkEvents();
                let multiplier = 1;
                
                events.active.forEach(event => {
                    if (type === 'xp' && event.id === 'event_double_xp') multiplier *= 2;
                    if (type === 'boss' && event.id === 'event_boss_rush') multiplier *= 2;
                    if (type === 'pet' && event.id === 'event_pet_boost') multiplier *= 3;
                });
                
                return multiplier;
            }

            // Load data from localStorage
            function loadStudyData() {
                try {
                    const data = localStorage.getItem('studentPersistentData');
                    if (data) {
                        return JSON.parse(data);
                    }
                } catch (e) {}
                return { studyData: { streak: 0, totalStudyHours: 0, studySessions: [], dailyStats: [] }, tasks: [] };
            }

            function loadRpgData() {
                try {
                    const saved = localStorage.getItem(RPG_STORAGE_KEY);
                    if (saved) {
                        return JSON.parse(saved);
                    }
                } catch (e) {}
                
                return {
                    level: 1, xp: 0, xpToNextLevel: 100, totalXP: 0,
                    strength: 5, intelligence: 5, wisdom: 5, luck: 5,
                    health: 100, maxHealth: 100, mana: 50, maxMana: 100,
                    questsCompleted: 0, perfectDays: 0, achievements: [],
                    titles: ['Novice Adventurer'], currentTitle: 'Novice Adventurer',
                    dailyQuests: getRandomQuests('daily', 4),
                    weeklyQuests: getRandomQuests('weekly', 3),
                    legendaryQuests: getRandomQuests('legendary', 5),
                    completedQuestIds: [],
                    dailyStreak: 0, lastDailyComplete: null,
                    lastDailyReset: new Date().toDateString(),
                    lastWeeklyReset: getWeekStart()
                };
            }

            function getRandomQuests(type, count) {
                const templates = QUEST_TEMPLATES[type];
                const shuffled = [...templates].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count).map(q => ({ 
                    ...q, 
                    progress: 0, 
                    completed: false, 
                    claimed: false,
                    isNew: true 
                }));
            }

            function getReplacementQuest(type, excludeIds = []) {
                const templates = QUEST_TEMPLATES[type].filter(q => !excludeIds.includes(q.id));
                if (templates.length === 0) {
                    return QUEST_TEMPLATES[type][Math.floor(Math.random() * QUEST_TEMPLATES[type].length)];
                }
                return templates[Math.floor(Math.random() * templates.length)];
            }

            function saveRpgData(data) {
                localStorage.setItem(RPG_STORAGE_KEY, JSON.stringify(data));
            }

            function getWeekStart() {
                const d = new Date();
                d.setDate(d.getDate() - d.getDay() + (d.getDay() === 0 ? -6 : 1));
                return d.toDateString();
            }

            function getTodayKey() {
                return new Date().toDateString();
            }

            function collectProgress() {
                const mainData = loadStudyData();
                const studyData = mainData.studyData || {};
                const tasks = mainData.tasks || [];
                
                const today = getTodayKey();
                const todayStats = studyData.dailyStats?.find(s => s?.date === today);
                
                const focusSessions = studyData.studySessions?.filter(s => {
                    if (!s?.date) return false;
                    return new Date(s.date).toDateString() === today && (s.hours || 0) >= 0.4;
                }).length || 0;
                
                const todayTasks = tasks.filter(t => {
                    if (!t?.completed || !t?.completedAt) return false;
                    return new Date(t.completedAt).toDateString() === today;
                }).length || 0;
                
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                
                const weeklyTasks = tasks.filter(t => {
                    if (!t?.completed || !t?.completedAt) return false;
                    return new Date(t.completedAt) >= weekAgo;
                }).length || 0;
                
                const weeklyHours = studyData.dailyStats?.reduce((sum, day) => {
                    if (!day?.date) return sum;
                    if (new Date(day.date) >= weekAgo) {
                        return sum + (day.hours || 0);
                    }
                    return sum;
                }, 0) || 0;
                
                const completedTasks = tasks.filter(t => t?.completed).length || 0;
                const totalHours = parseFloat(studyData.totalStudyHours || 0);
                const streak = studyData.streak || 0;
                
                const rpgData = loadRpgData();
                const questsCompleted = rpgData.questsCompleted || 0;
                
                const currentHour = new Date().getHours();
                const isEarlyBird = currentHour < 8;
                const isNightOwl = currentHour >= 22;
                
                return {
                    focusSessions, todayTasks,
                    streakMaintained: studyData.lastStudyDate === today ? 1 : 0,
                    todayHours: todayStats?.hours || 0,
                    streak, weeklyTasks, weeklyHours,
                    completedTasks, totalHours, questsCompleted,
                    isEarlyBird, isNightOwl,
                    allDailyCompleted: checkAllDailyCompleted()
                };
            }

            function checkAllDailyCompleted() {
                const data = loadRpgData();
                return data.dailyQuests.every(q => q.completed);
            }

            function updateQuests() {
                const data = loadRpgData();
                const progress = collectProgress();
                
                const today = getTodayKey();
                if (data.lastDailyReset !== today) {
                    data.dailyQuests = getRandomQuests('daily', 4);
                    data.lastDailyReset = today;
                }
                
                const weekStart = getWeekStart();
                if (data.lastWeeklyReset !== weekStart) {
                    data.weeklyQuests = getRandomQuests('weekly', 3);
                    data.lastWeeklyReset = weekStart;
                }
                
                let questCompleted = false;
                let completedQuestId = null;
                let completedCategory = null;
                let completedCount = 0;
                
                data.dailyQuests.forEach(quest => {
                    if (!quest.completed && !quest.claimed) {
                        if (quest.id === 'daily_focus') quest.progress = progress.focusSessions;
                        else if (quest.id === 'daily_tasks') quest.progress = progress.todayTasks;
                        else if (quest.id === 'daily_streak') quest.progress = progress.streakMaintained;
                        else if (quest.id === 'daily_hours') quest.progress = Math.floor(progress.todayHours);
                        else if (quest.id === 'daily_early') quest.progress = progress.isEarlyBird ? 1 : 0;
                        else if (quest.id === 'daily_night') quest.progress = progress.isNightOwl ? 1 : 0;
                        else if (quest.id === 'daily_perfect') quest.progress = progress.allDailyCompleted ? 1 : 0;
                        
                        if (quest.progress >= quest.requirement && !quest.completed) {
                            quest.completed = true;
                            questCompleted = true;
                            completedQuestId = quest.id;
                            completedCategory = 'daily';
                            completedCount++;
                        }
                    }
                });
                
                data.weeklyQuests.forEach(quest => {
                    if (!quest.completed && !quest.claimed) {
                        if (quest.id === 'weekly_streak') quest.progress = progress.streak;
                        else if (quest.id === 'weekly_tasks') quest.progress = progress.weeklyTasks;
                        else if (quest.id === 'weekly_hours') quest.progress = Math.floor(progress.weeklyHours);
                        else if (quest.id === 'weekly_focus') quest.progress = Math.floor(progress.weeklyHours / 2);
                        else if (quest.id === 'weekly_perfect') quest.progress = progress.streak >= 7 ? 1 : 0;
                        
                        if (quest.progress >= quest.requirement && !quest.completed) {
                            quest.completed = true;
                            questCompleted = true;
                            completedQuestId = quest.id;
                            completedCategory = 'weekly';
                            completedCount++;
                        }
                    }
                });
                
                data.legendaryQuests.forEach(quest => {
                    if (!quest.completed && !quest.claimed) {
                        if (quest.id === 'legend_first') quest.progress = progress.questsCompleted >= 1 ? 1 : 0;
                        else if (quest.id === 'legend_10') quest.progress = progress.questsCompleted >= 10 ? 1 : 0;
                        else if (quest.id === 'legend_50') quest.progress = progress.questsCompleted >= 50 ? 1 : 0;
                        else if (quest.id === 'legend_100') quest.progress = progress.questsCompleted >= 100 ? 1 : 0;
                        else if (quest.id === 'legend_streak_30') quest.progress = progress.streak >= 30 ? 1 : 0;
                        else if (quest.id === 'legend_tasks_500') quest.progress = progress.completedTasks >= 500 ? 1 : 0;
                        else if (quest.id === 'legend_hours_100') quest.progress = Math.floor(progress.totalHours) >= 100 ? 1 : 0;
                        
                        if (quest.progress >= quest.requirement && !quest.completed) {
                            quest.completed = true;
                            questCompleted = true;
                            completedQuestId = quest.id;
                            completedCategory = 'legendary';
                            completedCount++;
                        }
                    }
                });
                
                data.strength = 5 + Math.floor(progress.completedTasks / 10);
                data.intelligence = 5 + Math.floor(progress.totalHours / 5);
                data.wisdom = 5 + Math.floor(progress.streak / 3);
                data.mana = Math.min(data.maxMana, 50 + (progress.focusSessions * 10));
                data.health = Math.min(data.maxHealth, 70 + (progress.streak * 2));
                
                saveRpgData(data);
                
                // Update pet and boss based on completed quests
                if (completedCount > 0) {
                    const pet = updatePet(completedCount);
                    const boss = updateBoss(completedCount);
                    
                    // Show pet message occasionally
                    const petMessage = getPetMessage(pet);
                    if (petMessage) {
                        setTimeout(() => {
                            showNotification(`üêæ ${pet.name}: ${petMessage}`, 'info');
                        }, 1000);
                    }
                }
                
                if (questCompleted && completedQuestId && completedCategory) {
                    setTimeout(() => {
                        showNotification("‚ú® Quest completed! A new challenge appears!", "success");
                    }, 500);
                }
                
                return { data, questCompleted, completedQuestId, completedCategory };
            }

            function replaceCompletedQuest(category, completedId) {
                const data = loadRpgData();
                
                if (!data.completedQuestIds) data.completedQuestIds = [];
                data.completedQuestIds.push(completedId);
                
                if (data.completedQuestIds.length > 20) {
                    data.completedQuestIds = data.completedQuestIds.slice(-20);
                }
                
                const replacement = getReplacementQuest(category, data.completedQuestIds);
                
                if (category === 'daily') {
                    const index = data.dailyQuests.findIndex(q => q.id === completedId);
                    if (index !== -1) {
                        data.dailyQuests[index] = {
                            ...replacement,
                            progress: 0,
                            completed: false,
                            claimed: false,
                            isNew: true
                        };
                    }
                } else if (category === 'weekly') {
                    const index = data.weeklyQuests.findIndex(q => q.id === completedId);
                    if (index !== -1) {
                        data.weeklyQuests[index] = {
                            ...replacement,
                            progress: 0,
                            completed: false,
                            claimed: false,
                            isNew: true
                        };
                    }
                } else if (category === 'legendary') {
                    const index = data.legendaryQuests.findIndex(q => q.id === completedId);
                    if (index !== -1) {
                        data.legendaryQuests[index] = {
                            ...replacement,
                            progress: 0,
                            completed: false,
                            claimed: false,
                            isNew: true
                        };
                    }
                }
                
                saveRpgData(data);
                showNotification(`üîÑ New ${category} quest: ${replacement.name}!`, "info");
                
                return data;
            }

            function addXP(amount) {
                const xpMultiplier = getEventMultiplier('xp');
                const finalAmount = Math.floor(amount * xpMultiplier);
                
                const data = loadRpgData();
                data.xp += finalAmount;
                data.totalXP += finalAmount;
                
                let leveledUp = false;
                
                while (data.xp >= data.xpToNextLevel) {
                    data.xp -= data.xpToNextLevel;
                    data.level++;
                    data.xpToNextLevel = Math.floor(data.xpToNextLevel * 1.3);
                    
                    data.strength++;
                    data.intelligence++;
                    data.wisdom++;
                    data.luck++;
                    
                    leveledUp = true;
                    
                    showAchievement('LEVEL UP!', `You reached level ${data.level}!`, '‚≠ê');
                }
                
                if (xpMultiplier > 1) {
                    showNotification(`‚ú® Event bonus: ${xpMultiplier}x XP! (+${finalAmount} XP)`, 'success');
                } else {
                    showNotification(`‚ú® +${finalAmount} XP`, 'success');
                }
                
                saveRpgData(data);
                render();
                return data;
            }

            function claimQuest(questId, category) {
                const data = loadRpgData();
                let quests = [];
                
                if (category === 'daily') quests = data.dailyQuests;
                else if (category === 'weekly') quests = data.weeklyQuests;
                else if (category === 'legendary') quests = data.legendaryQuests;
                
                const questIndex = quests.findIndex(q => q.id === questId);
                const quest = quests[questIndex];
                
                if (!quest || !quest.completed || quest.claimed) {
                    showNotification("Cannot claim - already completed", "error");
                    return;
                }
                
                quest.claimed = true;
                data.questsCompleted++;
                
                if (quest.stats) {
                    Object.entries(quest.stats).forEach(([stat, value]) => {
                        if (stat === 'all') {
                            data.strength += value;
                            data.intelligence += value;
                            data.wisdom += value;
                            data.luck += value;
                        } else {
                            data[stat] += value;
                        }
                    });
                }
                
                saveRpgData(data);
                
                // Apply event multiplier to XP
                const xpMultiplier = getEventMultiplier('xp');
                const finalXP = Math.floor(quest.xp * xpMultiplier);
                
                addXP(finalXP - quest.xp); // Add the bonus separately
                addXP(quest.xp); // This will trigger the multiplier again, but that's okay
                
                const questElement = document.querySelector(`[data-quest-id="${questId}"]`);
                if (questElement) {
                    questElement.classList.add('completed');
                }
                
                showNotification(`‚ú® Quest Complete! +${quest.xp} XP`, "success");
                
                setTimeout(() => {
                    replaceCompletedQuest(category, questId);
                    render();
                }, 500);
            }

            function rollDice() {
                const data = loadRpgData();
                
                if (data.mana < 5) {
                    showNotification("Not enough mana! Need 5 mana.", "error");
                    return;
                }
                
                data.mana -= 5;
                
                const roll1 = Math.floor(Math.random() * 6) + 1;
                const roll2 = Math.floor(Math.random() * 6) + 1;
                const total = roll1 + roll2;
                
                let xpGain = 10;
                let message = 'üé≤ +10 XP';
                
                if (total === 12) {
                    xpGain = 100;
                    message = 'üåü PERFECT ROLL! +100 XP!';
                    showAchievement('PERFECT ROLL!', 'You rolled a 12!', 'üé≤');
                } else if (total >= 10) {
                    xpGain = 50;
                    message = '‚ú® Great roll! +50 XP!';
                } else if (total >= 7) {
                    xpGain = 25;
                    message = 'üëç Good roll! +25 XP!';
                }
                
                saveRpgData(data);
                addXP(xpGain);
                showNotification(message, "success");
                render();
            }

            function gmClick() {
                const bubble = document.getElementById('gmBubble');
                const data = loadRpgData();
                const progress = collectProgress();
                const events = checkEvents();
                const pet = loadPetData();
                const boss = loadBossData();
                
                const messages = Object.values(GM_MESSAGES);
                let message = messages[Math.floor(Math.random() * messages.length)];
                
                // Add event messages if events are active
                if (events.active.length > 0) {
                    const event = events.active[0];
                    message = `üéâ Special event: ${event.name}! ${event.description}`;
                }
                
                message = message
                    .replace('{{xp}}', data.xp)
                    .replace('{{xpNeeded}}', data.xpToNextLevel - data.xp)
                    .replace('{{nextLevel}}', data.level + 1)
                    .replace('{{health}}', Math.round(data.health))
                    .replace('{{maxHealth}}', data.maxHealth)
                    .replace('{{mana}}', Math.round(data.mana))
                    .replace('{{maxMana}}', data.maxMana)
                    .replace('{{str}}', data.strength)
                    .replace('{{int}}', data.intelligence)
                    .replace('{{wis}}', data.wisdom)
                    .replace('{{luk}}', data.luck)
                    .replace('{{tasks}}', progress.completedTasks)
                    .replace('{{hours}}', Math.round(progress.totalHours))
                    .replace('{{streak}}', progress.streak)
                    .replace('{{dailyDone}}', data.dailyQuests.filter(q => q.completed).length)
                    .replace('{{dailyTotal}}', data.dailyQuests.length)
                    .replace('{{dailyLeft}}', data.dailyQuests.length - data.dailyQuests.filter(q => q.completed).length)
                    .replace('{{weeklyDone}}', data.weeklyQuests.filter(q => q.completed).length)
                    .replace('{{weeklyTotal}}', data.weeklyQuests.length)
                    .replace('{{weeklyLeft}}', data.weeklyQuests.length - data.weeklyQuests.filter(q => q.completed).length)
                    .replace('{{legendaryDone}}', data.legendaryQuests.filter(q => q.completed).length)
                    .replace('{{legendaryTotal}}', data.legendaryQuests.length)
                    .replace('{{legendaryLeft}}', data.legendaryQuests.length - data.legendaryQuests.filter(q => q.completed).length)
                    .replace('{{level}}', data.level)
                    .replace('{{xpToNext}}', data.xpToNextLevel);
                
                bubble.textContent = 'üßô‚Äç‚ôÇÔ∏è ' + message;
                
                bubble.style.animation = 'none';
                bubble.offsetHeight;
                bubble.style.animation = 'bubbleAppear 0.3s ease-out';
            }

            function render() {
                const { data } = updateQuests();
                const progress = collectProgress();
                const events = checkEvents();
                const pet = loadPetData();
                const boss = loadBossData();
                const content = document.getElementById('questContent');
                
                const xpPercent = (data.xp / data.xpToNextLevel) * 100;
                const healthPercent = (data.health / data.maxHealth) * 100;
                const manaPercent = (data.mana / data.maxMana) * 100;
                const bossHealthPercent = boss.defeated ? 100 : (boss.health / boss.maxHealth) * 100;
                const petLevelPercent = (pet.xp / pet.xpToNextLevel) * 100;
                
                const currentTitle = GAME_TITLES.find(t => t.level <= data.level) || GAME_TITLES[0];
                const streakFlame = getStreakFlame(progress.streak);
                const petMessage = getPetMessage(pet);
                
                content.innerHTML = `
                    <!-- Hero Section with Streak Flame -->
                    <div class="hero-section">
                        <div class="player-card">
                            <div class="player-avatar">${currentTitle.icon}</div>
                            <div class="player-name">${localStorage.getItem('studentName') || 'Adventurer'}</div>
                            <div class="player-title">${currentTitle.icon} ${data.currentTitle} (Lv.${data.level})</div>
                            <div style="margin-top: var(--space-md); display: flex; align-items: center; justify-content: center; gap: var(--space-xs); flex-wrap: wrap;">
                                <span class="streak-flame">${streakFlame.split(' ')[0]}</span>
                                <span class="streak-counter">${progress.streak} day streak</span>
                            </div>
                        </div>
                        
                        <div class="resource-bars">
                            <div class="resource-item">
                                <div class="resource-header">
                                    <span>‚ú® XP to Level ${data.level + 1}</span>
                                    <span>${data.xp}/${data.xpToNextLevel}</span>
                                </div>
                                <div class="resource-track">
                                    <div class="resource-fill xp" style="width: ${xpPercent}%;"></div>
                                </div>
                            </div>
                            
                            <div class="resource-item">
                                <div class="resource-header">
                                    <span>‚ù§Ô∏è Health</span>
                                    <span>${Math.round(data.health)}/${Math.round(data.maxHealth)}</span>
                                </div>
                                <div class="resource-track">
                                    <div class="resource-fill health" style="width: ${healthPercent}%;"></div>
                                </div>
                            </div>
                            
                            <div class="resource-item">
                                <div class="resource-header">
                                    <span>üíô Mana</span>
                                    <span>${Math.round(data.mana)}/${Math.round(data.maxMana)}</span>
                                </div>
                                <div class="resource-track">
                                    <div class="resource-fill mana" style="width: ${manaPercent}%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üí™</div>
                            <div class="stat-content">
                                <div class="stat-label">Strength</div>
                                <div class="stat-value">${data.strength}</div>
                                <div class="stat-bonus">${progress.completedTasks} tasks</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üß†</div>
                            <div class="stat-content">
                                <div class="stat-label">Intelligence</div>
                                <div class="stat-value">${data.intelligence}</div>
                                <div class="stat-bonus">${Math.round(progress.totalHours)} hrs</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-content">
                                <div class="stat-label">Wisdom</div>
                                <div class="stat-value">${data.wisdom}</div>
                                <div class="stat-bonus">${progress.streak} day streak</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üçÄ</div>
                            <div class="stat-content">
                                <div class="stat-label">Luck</div>
                                <div class="stat-value">${data.luck}</div>
                                <div class="stat-bonus">${data.perfectDays} perfect days</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="action-btn" onclick="window.rollDice()" ${data.mana < 5 ? 'disabled' : ''}>
                            üé≤ Roll Dice (5 Mana)
                        </button>
                        <button class="action-btn" onclick="window.gmClick()">
                            üßô Ask Game Master
                        </button>
                        <button class="action-btn" onclick="window.location.reload()">
                            üîÑ Refresh
                        </button>
                    </div>
                    
                    <!-- FEATURE 3: PET COMPANION -->
                    <div class="pet-section">
                        <div class="pet-container">
                            <div class="pet-avatar" onclick="petInteract()" title="Click to interact!">${pet.type}</div>
                            <div class="pet-info">
                                <div class="pet-name">${pet.name} (Lv.${pet.level})</div>
                                <div class="pet-level-bar">
                                    <div class="pet-level-fill" style="width: ${petLevelPercent}%;"></div>
                                </div>
                                <div class="pet-messages">
                                    ${petMessage || "Click on your pet!"}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- FEATURE 4: BOSS BATTLE -->
                    <div class="boss-section">
                        <div class="boss-header">
                            <div class="boss-icon">${boss.defeated ? 'üëë' : 'üëæ'}</div>
                            <div>
                                <div class="boss-title">${boss.defeated ? 'BOSS DEFEATED!' : `BOSS LEVEL ${boss.level}`}</div>
                                <div style="color: var(--text-muted);">Defeat the boss for massive rewards!</div>
                            </div>
                        </div>
                        
                        <div class="boss-health-bar">
                            <div class="boss-health-fill" style="width: ${bossHealthPercent}%;"></div>
                        </div>
                        
                        <div class="boss-stats">
                            <div class="boss-stat">
                                <div style="font-size: 1.2rem; font-weight: 700; color: var(--boss-red);">${boss.defeated ? '0' : boss.health}</div>
                                <div style="font-size: 0.8rem;">Health Remaining</div>
                            </div>
                            <div class="boss-stat">
                                <div style="font-size: 1.2rem; font-weight: 700; color: var(--boss-red);">${boss.rewards[boss.currentReward]}</div>
                                <div style="font-size: 0.8rem;">Reward XP</div>
                            </div>
                            <div class="boss-stat">
                                <div style="font-size: 1.2rem; font-weight: 700; color: var(--boss-red);">${boss.level}</div>
                                <div style="font-size: 0.8rem;">Boss Level</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- FEATURE 5: SPECIAL EVENTS -->
                    ${events.active.length > 0 ? `
                    <div class="events-section">
                        <div class="category-header">
                            <div class="category-icon">üéâ</div>
                            <div class="category-title">ACTIVE EVENTS</div>
                            <div class="category-badge">LIVE NOW</div>
                        </div>
                        <div class="events-grid">
                            ${events.active.map(event => {
                                const timeLeft = Math.max(0, Math.floor((event.endTime - Date.now()) / 1000 / 60));
                                const hours = Math.floor(timeLeft / 60);
                                const minutes = timeLeft % 60;
                                return `
                                    <div class="event-card active">
                                        <div class="event-timer">${hours}h ${minutes}m left</div>
                                        <div class="event-icon">${event.icon}</div>
                                        <div class="event-name">${event.name}</div>
                                        <div class="event-desc">${event.description}</div>
                                        <div class="event-reward">${event.reward}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${events.upcoming.length > 0 ? `
                    <div class="events-section">
                        <div class="category-header">
                            <div class="category-icon">üìÖ</div>
                            <div class="category-title">UPCOMING EVENTS</div>
                        </div>
                        <div class="events-grid">
                            ${events.upcoming.slice(0, 2).map(event => {
                                const timeToStart = Math.max(0, Math.floor((event.startTime - Date.now()) / 1000 / 60 / 60));
                                return `
                                    <div class="event-card">
                                        <div class="event-icon">${event.icon}</div>
                                        <div class="event-name">${event.name}</div>
                                        <div class="event-desc">Starts in ${timeToStart}h</div>
                                        <div class="event-reward">${event.reward}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Daily Quests -->
                    <div class="quest-category">
                        <div class="category-header">
                            <div class="category-icon">üìÖ</div>
                            <div class="category-title">Daily Quests</div>
                            <div class="category-badge">üî• ${data.dailyStreak} Day Streak</div>
                        </div>
                        ${renderQuests(data.dailyQuests, 'daily')}
                    </div>
                    
                    <!-- Weekly Quests -->
                    <div class="quest-category">
                        <div class="category-header">
                            <div class="category-icon">üìÜ</div>
                            <div class="category-title">Weekly Quests</div>
                            <div class="category-badge">‚öîÔ∏è Epic Rewards</div>
                        </div>
                        ${renderQuests(data.weeklyQuests, 'weekly')}
                    </div>
                    
                    <!-- Legendary Quests -->
                    <div class="quest-category">
                        <div class="category-header">
                            <div class="category-icon">üåü</div>
                            <div class="category-title">Legendary Quests</div>
                            <div class="category-badge">${data.legendaryQuests.filter(q => q.completed).length}/${data.legendaryQuests.length}</div>
                        </div>
                        ${renderQuests(data.legendaryQuests, 'legendary')}
                    </div>
                `;
            }

            function renderQuests(quests, category) {
                if (!quests || quests.length === 0) {
                    return '<div class="empty-state">No quests available</div>';
                }
                
                return quests.map(quest => {
                    const progressPercent = (quest.progress / quest.requirement) * 100;
                    const canClaim = quest.completed && !quest.claimed;
                    
                    let statRewards = '';
                    if (quest.stats) {
                        statRewards = Object.entries(quest.stats).map(([stat, value]) => {
                            const icons = { strength: 'üí™', intelligence: 'üß†', wisdom: 'üìö', luck: 'üçÄ', all: 'üìä' };
                            return `<span class="reward-chip">${icons[stat] || '‚ú®'} +${value}</span>`;
                        }).join('');
                    }
                    
                    const newQuestClass = quest.isNew ? 'new-quest' : '';
                    const newQuestBadge = quest.isNew ? '<div class="new-quest-badge">NEW!</div>' : '';
                    
                    return `
                        <div class="quest-card ${quest.rarity} ${newQuestClass}" data-quest-id="${quest.id}">
                            ${newQuestBadge}
                            <div class="quest-header">
                                <div class="quest-icon">${quest.icon}</div>
                                <div class="quest-info">
                                    <div class="quest-name">${quest.name}</div>
                                    <div class="quest-meta">
                                        <span class="quest-rarity ${quest.rarity}">${quest.rarity}</span>
                                        <span class="quest-xp">‚ú® ${quest.xp} XP</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="quest-description">${quest.description}</div>
                            
                            <div class="quest-rewards">
                                ${statRewards}
                            </div>
                            
                            <div class="quest-progress">
                                <div class="progress-track">
                                    <div class="progress-fill" style="width: ${progressPercent}%;"></div>
                                </div>
                                <div class="progress-text">
                                    <span>Progress: ${quest.progress}/${quest.requirement}</span>
                                    <span>${Math.round(progressPercent)}%</span>
                                </div>
                            </div>
                            
                            <div class="quest-actions">
                                ${canClaim ? 
                                    `<button class="quest-btn claim" onclick="window.claimQuest('${quest.id}', '${category}')">
                                        ‚ú® CLAIM REWARDS
                                    </button>` : 
                                    quest.claimed ?
                                    `<button class="quest-btn" disabled>‚úì COMPLETED</button>` :
                                    `<button class="quest-btn" disabled>IN PROGRESS</button>`
                                }
                            </div>
                        </div>
                    `;
                }).join('');
            }

            function showNotification(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.innerHTML = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }

            // Pet interaction
            window.petInteract = function() {
                const pet = loadPetData();
                const randomMessage = pet.messages[Math.floor(Math.random() * pet.messages.length)];
                showNotification(`üêæ ${pet.name}: ${randomMessage}`, 'info');
            };

            // Make functions globally available
            window.claimQuest = claimQuest;
            window.rollDice = rollDice;
            window.gmClick = gmClick;
            window.goBack = function() {
                window.location.href = 'studentmode.html';
            };

            // Initialize
            render();
            
            // Auto-refresh every 30 seconds
            setInterval(render, 30000);
            
            // Show initial GM message after 2 seconds
            setTimeout(() => {
                gmClick();
            }, 2000);
            
            // Check events every minute
            setInterval(() => {
                checkEvents();
                render();
            }, 60000);
        })();
    </script>
</body>
</html>
